<h2 mat-dialog-title>Upload Agenda from Excel</h2>
<mat-dialog-content>
  <mat-card class="modern-card">
    <mat-card-content>
      <!-- Upload section remains unchanged -->
      <div *ngIf="!sessions.length" class="upload-section">
        <input
          #fileInput
          (change)="onFileChange($event)"
          accept=".xlsx, .xls"
          hidden
          type="file" />
        <div
          class="drop-zone"
          [class.dragover]="isDragging"
          (click)="fileInput.click()"
          (dragover)="onDragOver($event)"
          (drop)="onFileDrop($event)">
          <mat-icon class="upload-icon">cloud_upload</mat-icon>
          <div class="upload-text">
            <p>Drag & Drop Excel File</p>
            <p class="subtext">or click to browse</p>
          </div>
        </div>
      </div>

      <!-- Error message remains unchanged -->
      <div *ngIf="errorMessage" class="error-message">
        <mat-icon>error_outline</mat-icon>
        <span>{{ errorMessage }}</span>
      </div>

      <!-- Timezone Dropdown -->
      <div
        *ngIf="sessions.length"
        class="timezone-section"
        style="margin-bottom: 16px">
        <mat-form-field class="full-width" appearance="outline">
          <mat-label>Timezone</mat-label>
          <mat-select [(ngModel)]="selectedTimezone">
            <mat-option *ngFor="let tz of timezones" [value]="tz.value">
              {{ tz.label }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <!-- Accordion for session preview -->
      <div *ngIf="sessions.length" class="preview-section">
        <h3 class="preview-title">
          Session Preview
          <span class="count-badge">{{ sessions.length }} sessions</span>
        </h3>
        <mat-accordion>
          <mat-expansion-panel *ngFor="let session of sessions; let i = index">
            <mat-expansion-panel-header>
              <mat-panel-title>
                {{ session.StartsAt | date: 'short' }}
              </mat-panel-title>
              <mat-panel-description>
                {{ session.SessionTitle || 'Untitled Session' }}
              </mat-panel-description>
            </mat-expansion-panel-header>
            <div class="session-details">
              <!-- Session Title -->
              <mat-form-field class="full-width" appearance="outline">
                <mat-label>Session Title</mat-label>
                <input
                  matInput
                  [(ngModel)]="session.SessionTitle"
                  placeholder="Session title" />
              </mat-form-field>
              <div class="Input-field-row">
                <!-- Starts At -->
                <mat-form-field class="full-width" appearance="outline">
                  <mat-label>Starts At</mat-label>
                  <input
                    matInput
                    [(ngModel)]="session.StartsAt"
                    type="datetime-local" />
                </mat-form-field>
                <!-- Ends At -->
                <mat-form-field class="full-width" appearance="outline">
                  <mat-label>Ends At</mat-label>
                  <input
                    matInput
                    [(ngModel)]="session.EndsAt"
                    type="datetime-local" />
                </mat-form-field>
                <mat-form-field class="full-width" appearance="outline">
                  <mat-label>Track</mat-label>
                  <input
                    matInput
                    [matAutocomplete]="auto"
                    [(ngModel)]="session.Track"
                    placeholder="Select or enter track"
                    type="text" />
                  <mat-autocomplete #auto="matAutocomplete">
                    <mat-option
                      *ngFor="
                        let option of getFilteredTrackOptions(session.Track)
                      "
                      [value]="option">
                      {{ option }}
                    </mat-option>
                  </mat-autocomplete>
                </mat-form-field>
              </div>

              <!-- Type -->
              <mat-form-field class="full-width" appearance="outline">
                <mat-label>Type</mat-label>
                <mat-select [(ngModel)]="session.Type">
                  <mat-option value="Keynote">Keynote</mat-option>
                  <mat-option value="PrimarySession"
                    >Primary Session</mat-option
                  >
                  <mat-option value="BreakoutSession"
                    >Breakout Session</mat-option
                  >
                  <mat-option value="presentation">Presentation</mat-option>
                  <mat-option value="fireside_chat">Fireside chat</mat-option>
                  <mat-option value="audience_debate"
                    >Audience Debate</mat-option
                  >
                  <mat-option value="panel_discussion"
                    >Panel discussion</mat-option
                  >
                </mat-select>
              </mat-form-field>
              <!-- Location -->
              <mat-form-field class="full-width" appearance="outline">
                <mat-label>Location / Stage</mat-label>
                <input
                  matInput
                  [(ngModel)]="session.Location"
                  placeholder="Stage" />
              </mat-form-field>
              <mat-form-field class="full-width" appearance="outline">
                <mat-label>Session Description</mat-label>
                <textarea
                  matInput
                  [(ngModel)]="session.SessionDescription"
                  placeholder="Session Description"></textarea>
              </mat-form-field>

              <!-- Speaker Info Section -->
              <div
                class="speaker-info-section"
                style="
                  margin-top: 16px;
                  padding: 8px;
                  border: 1px solid #e0e0e0;
                  border-radius: 4px;
                ">
                <h4>Speaker Info</h4>
                <div
                  *ngFor="let speaker of session.SpeakersInfo; let j = index"
                  class="speaker-info-item"
                  style="margin-bottom: 12px">
                  <!-- Speaker Name -->
                  <div style="display: flex; flex-direction: row">
                    <mat-form-field class="full-width" appearance="outline">
                      <mat-label>Speaker Name</mat-label>
                      <input
                        matInput
                        [(ngModel)]="speaker.Name"
                        placeholder="Speaker Name" />
                    </mat-form-field>
                    <!-- Speaker Title -->
                    <mat-form-field class="full-width" appearance="outline">
                      <mat-label>Title</mat-label>
                      <input
                        matInput
                        [(ngModel)]="speaker.Title"
                        placeholder="Title" />
                    </mat-form-field>
                    <mat-form-field class="full-width" appearance="outline">
                      <mat-label>Organization</mat-label>
                      <input
                        matInput
                        [(ngModel)]="speaker.Organization"
                        placeholder="Organization" />
                    </mat-form-field>
                  </div>

                  <!-- Speaker URL -->
                  <mat-form-field class="full-width" appearance="outline">
                    <mat-label>URL</mat-label>
                    <input
                      matInput
                      [(ngModel)]="speaker.Url"
                      placeholder="Url" />
                  </mat-form-field>
                  <!-- Speaker Bio -->
                  <mat-form-field class="full-width" appearance="outline">
                    <mat-label>Speaker Bio</mat-label>
                    <textarea
                      matInput
                      [(ngModel)]="speaker.SpeakerBio"
                      placeholder="Speaker Bio"></textarea>
                  </mat-form-field>
                  <!-- Speaker Organisation -->

                  <!-- Is Moderator -->
                  <div
                    style="
                      display: flex;
                      flex-direction: row;
                      justify-content: space-between;
                    ">
                    <mat-checkbox [(ngModel)]="speaker.isModerator"
                      >Moderator</mat-checkbox
                    >
                    <!-- Remove Speaker Button -->
                    <button
                      mat-stroked-button
                      (click)="removeSpeaker(session, j)"
                      color="warn">
                      Remove Speaker
                    </button>
                  </div>
                </div>
                <button
                  mat-stroked-button
                  (click)="addSpeaker(session)"
                  color="primary">
                  Add Speaker
                </button>
              </div>
              <!-- End Speaker Info Section -->
            </div>
          </mat-expansion-panel>
        </mat-accordion>
      </div>
    </mat-card-content>
  </mat-card>
</mat-dialog-content>
<mat-dialog-actions class="dialog-actions" align="end">
  @if (isLoading) {
    <div class="loading-container">
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    </div>
  } @else {
    <button mat-stroked-button (click)="close()">Cancel</button>
    <button
      mat-raised-button
      [disabled]="!sessions.length"
      (click)="confirm()"
      color="primary">
      Confirm Upload
    </button>
  }
</mat-dialog-actions>
