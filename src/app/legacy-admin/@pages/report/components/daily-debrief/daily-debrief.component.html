<div class="daily-debrief-container">
  <div class="filter-container">
    <div class="filter-label">
      <span>Filter</span>
    </div>
    <div class="filter-select">
      <mat-form-field class="file-filter-select" appearance="outline">
        <mat-label>Event Day</mat-label>
        <mat-select
          [value]="selectedEventDay"
          (selectionChange)="onEventDayFilterChange($event.value)">
          <mat-option value="">All Days</mat-option>
          @for (day of uniqueDays; track day) {
            <mat-option [value]="day">{{ day }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
    </div>
    <div class="generate-debrief-button">
      <button
        mat-raised-button
        matTooltip="Generate PDF V2 for selected event days"
        [disabled]="!selectedEvent || uniqueDays.length === 0 || selectedDailyDebriefs.size === 0"
        (click)="generateDailyDebrief.emit()"
        color="primary">
        <mat-icon>add</mat-icon>
        Generate PDF V2
      </button>
      <button
        mat-raised-button
        matTooltip="Publish all selected daily debrief reports (requires PDF V2)"
        [disabled]="selectedDailyDebriefs.size === 0"
        (click)="publishReport.emit()"
        color="accent"
        style="margin-left: 10px">
        <mat-icon>publish</mat-icon>
        Publish Report
      </button>
    </div>
  </div>
  <div class="daily-debrief-table-wrapper">
    <table
      mat-table
      matSort
      class="versions-table"
      [dataSource]="dataSource">
      <!-- Checkbox Column -->
      <ng-container matColumnDef="select">
        <th *matHeaderCellDef mat-header-cell>
          <mat-checkbox
            [checked]="isAllSelected()"
            [indeterminate]="isIndeterminate()"
            (change)="onToggleAll($event.checked)">
          </mat-checkbox>
        </th>
        <td
          *matCellDef="let row; let i = index"
          mat-cell
          [class.selected]="selectedRowIndex === i"
          (click)="onHighlightRow(row, i)">
          <mat-checkbox
            [checked]="isDailyDebriefSelected(row.EventDay)"
          
            (change)="onDailyDebriefToggle(row.EventDay, $event.checked)"
            (click)="$event.stopPropagation()">
          </mat-checkbox>
        </td>
      </ng-container>

      <!-- Event Day Column -->
      <ng-container matColumnDef="eventDay">
        <th *matHeaderCellDef mat-header-cell mat-sort-header>Event Day</th>
        <td
          *matCellDef="let row; let i = index"
          mat-cell
          [class.selected]="selectedRowIndex === i"
          (click)="onHighlightRow(row, i)">
          {{ row.EventDay }}
        </td>
      </ng-container>

      <!-- Edit Content Column -->
      <ng-container matColumnDef="viewContent">
        <th *matHeaderCellDef mat-header-cell>Edit Content</th>
        <td
          *matCellDef="let row; let i = index"
          mat-cell
          [class.selected]="selectedRowIndex === i"
          (click)="onHighlightRow(row, i)">
          @if (row.version) {
            <button
              mat-icon-button
              matTooltip="Edit Content"
              (click)="onEditContent(row); $event.stopPropagation()">
              <mat-icon>edit</mat-icon>
            </button>
          } @else {
            <span style="color: #999">N/A</span>
          }
        </td>
      </ng-container>

      <!-- PDF Path V2 Column -->
      <ng-container matColumnDef="pdfPathV2">
        <th *matHeaderCellDef mat-header-cell>PDF V2</th>
        <td
          *matCellDef="let row; let i = index"
          mat-cell
          [class.selected]="selectedRowIndex === i"
          (click)="onHighlightRow(row, i)">
          @if (row.pdfPathV2) {
            <button
              mat-icon-button
              matTooltip="Open PDF V2"
              (click)="onViewPdfV2(row); $event.stopPropagation()">
              <mat-icon>picture_as_pdf</mat-icon>
            </button>
          } @else {
            <span style="color: #999">N/A</span>
          }
        </td>
      </ng-container>

      <!-- Version Column -->
      <ng-container matColumnDef="version">
        <th *matHeaderCellDef mat-header-cell mat-sort-header>Version</th>
        <td
          *matCellDef="let row; let i = index"
          mat-cell
          [class.selected]="selectedRowIndex === i"
          (click)="onHighlightRow(row, i)">
          {{ row.version || 'N/A' }}
        </td>
      </ng-container>

      <!-- Publish PDF Column -->
      <ng-container matColumnDef="publishPdf">
        <th *matHeaderCellDef mat-header-cell>Publish PDF</th>
        <td
          *matCellDef="let row; let i = index"
          mat-cell
          [class.selected]="selectedRowIndex === i"
          (click)="onHighlightRow(row, i)">
          @if (row.reportUrl) {
            <button
              mat-icon-button
              matTooltip="Open Published PDF"
              (click)="onOpenPublishPdf(row.reportUrl!); $event.stopPropagation()">
              <mat-icon>picture_as_pdf</mat-icon>
            </button>
          } @else {
            <span style="color: #999">N/A</span>
          }
        </td>
      </ng-container>

      <!-- Table Header and Row Declarations -->
      <tr *matHeaderRowDef="displayedColumns" mat-header-row></tr>
      <tr *matRowDef="let row; columns: displayedColumns" mat-row></tr>
    </table>
    <mat-paginator
      [length]="dataSource.data.length"
      [pageSize]="pageSize"
      [pageSizeOptions]="[5, 10, 20, 50, 100, 200]"
      showFirstLastButtons>
    </mat-paginator>
  </div>
</div>

