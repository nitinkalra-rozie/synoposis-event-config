<div class="transcript-side-panel-content-container">
  <div class="side-panel-content-header">
    <div
      matTooltipClass="tooltip-text-only"
      matTooltipPosition="above"
      class="content-header-title"
      [tooltipOnOverflow]="sessionTitle()">
      {{ sessionTitle() || 'No session selected' }}
    </div>

    <div class="connection-status">
      @if ($vm().isConnecting) {
      <mat-icon class="connecting">sync</mat-icon>
      } @else if ($vm().isConnected) {
      <mat-icon class="connected">radio_button_checked</mat-icon>
      } @else if ($vm().connectionError) {
      <mat-icon class="error">error_outline</mat-icon>
      }
    </div>
  </div>

  <div class="side-panel-content-body">
    @switch (currentAction()) { @case ('SESSION_NOT_STARTED') {
    <ng-container *ngTemplateOutlet="defaultContent" />
    } @case ('SESSION_LIVE_LISTENING') { @if ($vm().connectionError) {
    <div class="connection-error">
      <div class="error-icon">
        <mat-icon>wifi_off</mat-icon>
      </div>
      <div class="error-message">{{ $vm().connectionError }}</div>
    </div>
    } @else if ($vm().showLoadingState) {
    <ng-container
      *ngTemplateOutlet="listeningContent; context: { text: 'Connecting to the Stage' }" />
    } @else if ($vm().hasTranscript) {
    <div class="transcript-container">
      <cdk-virtual-scroll-viewport
        #viewport
        class="transcript-viewport"
        (scrolledIndexChange)="onScroll()"
        itemSize="30">
        <div
          *cdkVirtualFor="let segment of $vm().transcriptSegments; trackBy: trackBySegment"
          class="transcript-segment">
          <div
            class="segment-text"
            [class.typewriter-active]="segment.id === lastSegmentId()">
            @if (segment.id === lastSegmentId()) {
            <span
              [isEnabled]="segment.id === lastSegmentId()"
              [text]="segment.text"
              typewriterAnimation>
            </span>
            } @else { {{ segment.text }} }
          </div>
        </div>
      </cdk-virtual-scroll-viewport>

      @if (userScrolledUp()) {
      <button
        mat-mini-fab
        class="scroll-to-bottom-btn"
        (click)="scrollToBottom()"
        aria-label="Scroll to bottom">
        <mat-icon>keyboard_arrow_down</mat-icon>
      </button>
      }
    </div>
    } @else {
    <ng-container
      *ngTemplateOutlet="listeningContent; context: { text: 'Listening to Speaker' }" />
    } } @case ('SESSION_LIVE_LISTENING_PAUSED') { @if ($vm().hasTranscript) {
    <div class="transcript-container paused">
      <div class="paused-banner">
        <mat-icon>pause_circle</mat-icon>
        <span>Session Paused</span>
      </div>

      <!-- Show existing transcript in read-only mode -->
      <cdk-virtual-scroll-viewport
        #viewport
        class="transcript-viewport"
        itemSize="30">
        <div
          *cdkVirtualFor="let segment of $vm().transcriptSegments; trackBy: trackBySegment"
          class="transcript-segment paused">
          <div class="segment-text">{{ segment.text }}</div>
        </div>
      </cdk-virtual-scroll-viewport>
    </div>
    } @else {
    <div class="paused-content">
      <div class="content-icon">
        <mat-icon>pause_circle_outline</mat-icon>
      </div>
      <div class="content-message">
        Session Paused. No live transcript is available to see.
      </div>
    </div>
    } } @case ('SESSION_END') {
    <div class="ended-content">
      <div class="content-icon">
        <mat-icon>info</mat-icon>
      </div>
      <div class="content-message">
        Session ended - No live transcript is available to see.
      </div>
    </div>
    } @default {
    <ng-container *ngTemplateOutlet="defaultContent" />
    } }
  </div>
</div>

<ng-template #defaultContent>
  <div class="not-started-content">
    <div class="transcript-icon">
      <mat-icon svgIcon="syn:document_type"></mat-icon>
    </div>
    <div class="not-started-content-description">
      Start Listening to Generate Transcript
    </div>
  </div>
</ng-template>

<ng-template #listeningContent let-text="text">
  <div class="listening-content">
    <div class="listening-indicator">
      <mat-icon class="listening-icon" svgIcon="syn:loading_spinner" />
      <div class="listening-indicator-text">
        {{text}}, Transcript is on the way...
      </div>
    </div>
  </div>
</ng-template>
